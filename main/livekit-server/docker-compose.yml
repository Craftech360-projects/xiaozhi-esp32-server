version: '3.8'

services:
  livekit-server:
    image: livekit/livekit-server:latest
    container_name: livekit-server
    restart: unless-stopped
    ports:
      - "7880-7882:7880-7882/tcp"
      - "50000-50200:50000-50200/udp"
    environment:
      LIVEKIT_KEYS: "devkey: secret"
      REDIS_URL: "redis://:redispassword@manager-api-redis:6379"
    networks:
      - manager-api_manager-api-network

  # Local Qdrant Vector Database
  qdrant:
    image: qdrant/qdrant:latest
    container_name: qdrant-local
    restart: unless-stopped
    ports:
      - "6333:6333"  # HTTP API
      - "6334:6334"  # gRPC API
    volumes:
      - qdrant_storage:/qdrant/storage
    # Uncomment below to set API key for security
    # environment:
    #   QDRANT__SERVICE__API_KEY: "your-api-key-here"
    networks:
      - manager-api_manager-api-network

  # Ollama Local LLM Server
  ollama:
    image: ollama/ollama:latest
    container_name: ollama-llm
    restart: unless-stopped
    ports:
      - "11434:11434"
    volumes:
      - ollama_data:/root/.ollama
    # Uncomment below for GPU support
    # environment:
    #   OLLAMA_GPU: "1"
    # deploy:
    #   resources:
    #     reservations:
    #       devices:
    #         - driver: nvidia
    #           count: 1
    #           capabilities: [gpu]
    networks:
      - manager-api_manager-api-network

  # Local Media Server (Nginx)
  media-server:
    image: nginx:alpine
    container_name: media-server
    restart: unless-stopped
    ports:
      - "8080:80"
    volumes:
      - ./local_media:/usr/share/nginx/html:ro
    networks:
      - manager-api_manager-api-network

networks:
  # Use existing manager-api network
  manager-api_manager-api-network:
    external: true

volumes:
  qdrant_storage:
    driver: local
  ollama_data:
    driver: local